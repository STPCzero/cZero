<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "=//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="kopo.poly.persistance.mapper.IAdminMapper">
    <!-- admin 유저 정보 출력 쿼리 -->
    <select id="getMembersInfo" parameterType="UserInfoDTO" resultType="UserInfoDTO">
        SELECT * FROM (
                          SELECT ROW_NUMBER() OVER (ORDER BY user_seq) NUM, U.*
                          FROM USER_INFO U
                          WHERE U.USER_NAME LIKE '%'||#{user_name}||'%'
                          ORDER BY USER_SEQ desc
                      )
        WHERE NUM BETWEEN #{start} AND #{finish}
    </select>

    <select id="getMembersCount" parameterType="UserInfoDTO" resultType="int">
        SELECT count(*) FROM USER_INFO WHERE USER_NAME LIKE '%'||#{user_name}||'%'
    </select>

    <delete id="delMembers" parameterType="UserInfoDTO">
        DELETE FROM USER_INFO
        WHERE USER_SEQ = #{user_seq}
    </delete>

<!-- 마켓 검색 -->
    <select id="getMarketInfo" parameterType="MarketDTO" resultType="MarketDTO">
        SELECT * FROM (
                          SELECT ROW_NUMBER() OVER (ORDER BY MK_SEQ) NUM, M.*,
                                 (SELECT U.USER_NAME
                                  FROM USER_INFO U
                                  WHERE U.USER_SEQ = M.USER_SEQ) USER_NAME
                          FROM MARKET M
                          WHERE M.TITLE LIKE '%'||#{title}||'%'
                          ORDER BY MK_SEQ desc
                      )
        WHERE NUM BETWEEN #{start} AND #{finish}
    </select>

    <select id="getMarketCount" parameterType="MarketDTO" resultType="int">
        SELECT count(*) FROM MARKET
    </select>
</mapper>
